"use strict";(self.webpackChunkmlops_made_easy=self.webpackChunkmlops_made_easy||[]).push([[7533],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=p(n),u=l,d=c["".concat(s,".").concat(u)]||c[u]||h[u]||i;return n?a.createElement(d,r(r({ref:t},m),{},{components:n})):a.createElement(d,r({ref:t},m))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:l,r[1]=o;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4672:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),l=(n(7294),n(3905));const i={sidebar_position:4},r="Helm",o={unversionedId:"kubernetes/helm",id:"kubernetes/helm",title:"Helm",description:"As we see from the previous section, even for a very basic application, we begin to need many manifest files. For a large enterprise application this can grow enormously in which it becomes cumbersome to kubectl create (or delete) so many files. Similarly, we may need to create many of the same application but with different configurations. This is where Helm comes in.",source:"@site/docs/02-kubernetes/04-helm.md",sourceDirName:"02-kubernetes",slug:"/kubernetes/helm",permalink:"/kubernetes/helm",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Up and Running",permalink:"/kubernetes/up-and-running"},next:{title:"\ud83d\udcb0 Cloud Computing",permalink:"/category/-cloud-computing"}},s={},p=[{value:"What is Helm",id:"what-is-helm",level:2},{value:"Installation",id:"installation",level:2},{value:"<code>helm repo</code>",id:"helm-repo",level:2},{value:"<code>helm install</code>",id:"helm-install",level:2},{value:"Values File",id:"values-file",level:2},{value:"<code>helm uninstall</code>",id:"helm-uninstall",level:2},{value:"<code>helm create</code>",id:"helm-create",level:2}],m={toc:p},c="wrapper";function h(e){let{components:t,...i}=e;return(0,l.kt)(c,(0,a.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"helm"},"Helm"),(0,l.kt)("p",null,"As we see from the previous section, even for a very basic application, we begin to need many manifest files. For a large enterprise application this can grow enormously in which it becomes cumbersome to ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl create")," (or ",(0,l.kt)("inlineCode",{parentName:"p"},"delete"),") so many files. Similarly, we may need to create many of the same application but with different configurations. This is where ",(0,l.kt)("inlineCode",{parentName:"p"},"Helm")," comes in."),(0,l.kt)("h2",{id:"what-is-helm"},"What is Helm"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Helm")," is a package manager for Kubernetes applications. You can group together multiple Kubernetes manifests into one folder, and have a single ",(0,l.kt)("inlineCode",{parentName:"p"},"Helm")," definition file describe the ",(0,l.kt)("inlineCode",{parentName:"p"},"chart")," (packages in Helm are called ",(0,l.kt)("inlineCode",{parentName:"p"},"charts"),"). Also, Helm uses ",(0,l.kt)("a",{parentName:"p",href:"https://pkg.go.dev/text/template"},"Go's templating engine")," to make the underlying Kubernetes manifests more dynamic where you can use variables."),(0,l.kt)("p",null,"This can also be handy to separate chart maintainer from chart user. E.g. The chart maintainer can package up a bunch of k8s manifests that make up an application as a helm chart and only expose a few key parameters as variables. So the user won't have to dig through the manifests to change things, instead can just change the exposed parameter. This will make sense shortly when we create our own chart."),(0,l.kt)("h2",{id:"installation"},"Installation"),(0,l.kt)("p",null,"First let's install Helm. It's best to follow their guide for your particular operating system: ",(0,l.kt)("a",{parentName:"p",href:"https://helm.sh/docs/intro/install/"},"here"),"."),(0,l.kt)("p",null,"We can test if the installation worked by checking the Helm version that was (hopefully) installed."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm version\n")),(0,l.kt)("h2",{id:"helm-repo"},(0,l.kt)("inlineCode",{parentName:"h2"},"helm repo")),(0,l.kt)("p",null,"Helm uses the concept of a ",(0,l.kt)("inlineCode",{parentName:"p"},"repository")," as somewhere which charts are stored. A very popular chart repository is managed by ",(0,l.kt)("a",{parentName:"p",href:"https://artifacthub.io/packages/search?org=bitnami&sort=relevance&page=1"},"Bitnami"),". We can add their repository address to Helm using the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add bitnami https://charts.bitnami.com/bitnami\n")),(0,l.kt)("p",null,"We now have access to a ton of pre-build charts of popular open-source applications packaged up as Helm charts, ready to be installed in our Kubernetes cluster."),(0,l.kt)("h2",{id:"helm-install"},(0,l.kt)("inlineCode",{parentName:"h2"},"helm install")),(0,l.kt)("p",null,"The command ",(0,l.kt)("inlineCode",{parentName:"p"},"helm install")," will, as the name suggests, install an application into our cluster from a specified Helm chart. We'll stick with our basic nginx example. Luckily, Bitnami manage an Nginx chart ready to install. The command below tells ",(0,l.kt)("inlineCode",{parentName:"p"},"helm")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"install")," a chart, name it ",(0,l.kt)("inlineCode",{parentName:"p"},"my-nginx")," and get it from the ",(0,l.kt)("inlineCode",{parentName:"p"},"bitnami")," repo, and from that repo, use the chart named ",(0,l.kt)("inlineCode",{parentName:"p"},"nginx"),"."),(0,l.kt)("admonition",{title:"Note",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"We're also using the flag ",(0,l.kt)("inlineCode",{parentName:"p"},"-n")," (short for namespace, ",(0,l.kt)("inlineCode",{parentName:"p"},"--namespace")," would also work) to tell Helm to install it in the ",(0,l.kt)("inlineCode",{parentName:"p"},"nginx")," namespace. Now, this would error because we haven't create a namespace called ",(0,l.kt)("inlineCode",{parentName:"p"},"nginx"),", so we also use the flag ",(0,l.kt)("inlineCode",{parentName:"p"},"--create-namespace")," to tell Helm that if the namespace we specified doesn't exist then to create it first.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm install my-nginx bitnami/nginx -n nginx --create-namespace\n")),(0,l.kt)("p",null,"We can list all charts that have been installed in the ",(0,l.kt)("inlineCode",{parentName:"p"},"nginx")," namespace with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm list -n nginx\n")),(0,l.kt)("p",null,"Hopefully we should see something like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION\nmy-nginx        nginx           1               2023-05-11 21:19:31.764271744 +0100 BST deployed        nginx-14.0.0    1.24.0\n")),(0,l.kt)("p",null,"We can also use ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," to see all the objects created using the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get all -n nginx\n")),(0,l.kt)("p",null,"Giving something like:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME                            READY   STATUS    RESTARTS   AGE\npod/my-nginx-74b4885cbf-86dvt   1/1     Running   0          13s\n\nNAME               TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\nservice/my-nginx   LoadBalancer   10.96.79.211   <pending>     80:30874/TCP   13s\n\nNAME                       READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/my-nginx   1/1     1            1           13s\n\nNAME                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps/my-nginx-74b4885cbf   1         1         1       13s\n")),(0,l.kt)("admonition",{title:"Note",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"We can see the chart created a service of type ",(0,l.kt)("inlineCode",{parentName:"p"},"LoadBalancer"),". But what if we would prefer type ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterIP")," instead?")),(0,l.kt)("h2",{id:"values-file"},"Values File"),(0,l.kt)("p",null,"Helm uses a ",(0,l.kt)("inlineCode",{parentName:"p"},"values file")," which overwrites the 'templated' values in the manifests (we'll see this in greater detail ",(0,l.kt)("a",{parentName:"p",href:"#helm-create"},"when we create out own Helm chart"),"). Each chart comes with default values used for these templated variables, and if you don't do anything, they will be used. We can see the default values ",(0,l.kt)("a",{parentName:"p",href:"https://artifacthub.io/packages/helm/bitnami/nginx?modal=values&path=service"},"here"),". There is ",(0,l.kt)("strong",{parentName:"p"},"a lot")," of lines here. These types of publicly available charts are very comprehensive to be maximally flexible for users. Though, the above link should take you to the exact section we're interested in. We can see that the default value for ",(0,l.kt)("inlineCode",{parentName:"p"},"service.type")," is ",(0,l.kt)("inlineCode",{parentName:"p"},"LoadBalancer"),"."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"values",src:n(7307).Z,width:"715",height:"327"})),(0,l.kt)("p",null,"Now the beauty of Helm is that we can chose to overwrite only what we want. So we can create a file called ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," and just add the two lines below:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="values.yaml"',title:'"values.yaml"'},"service:\n  type: ClusterIP\n")),(0,l.kt)("p",null,"And when using this with Helm, it will overwrite those specifically, and use the default values for everything else."),(0,l.kt)("p",null,"We can use the ",(0,l.kt)("inlineCode",{parentName:"p"},"helm upgrade")," command to upgrade an already installed application using the form ",(0,l.kt)("inlineCode",{parentName:"p"},"helm upgrade <release-name> <repo-name>/<chart-name> --values <path-to-values-file>"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm upgrade my-nginx bitnami/nginx --values values.yaml -n nginx\n")),(0,l.kt)("admonition",{title:"Note",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"We could have used the command below if we hadn't already installed this chart with name ",(0,l.kt)("inlineCode",{parentName:"p"},"my-nginx"),"."),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"helm install my-nginx bitnami/nginx --values values.yaml -n nginx --create-namespace")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"install")," is used for creating a new application. ",(0,l.kt)("inlineCode",{parentName:"p"},"upgrade")," is for updating an already installed application.")),(0,l.kt)("p",null,"Now if we use the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get service -n nginx\n")),(0,l.kt)("p",null,"We should hopefully get something like:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nmy-nginx   ClusterIP   10.96.79.211   <none>        80/TCP    38m\n")),(0,l.kt)("p",null,"Great, our service has been updated to be of type ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterIP"),", and this was done with a Helm values file; we didn't have to dig through the underlying kubernetes object definition manifest files that make up the application."),(0,l.kt)("h2",{id:"helm-uninstall"},(0,l.kt)("inlineCode",{parentName:"h2"},"helm uninstall")),(0,l.kt)("p",null,"Before we learn how to create our own Helm chart we can clean up our previous installation with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm uninstall my-nginx -n nginx\n")),(0,l.kt)("h2",{id:"helm-create"},(0,l.kt)("inlineCode",{parentName:"h2"},"helm create")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm create my-app\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},".\n\u2514\u2500\u2500 my-app\n    \u251c\u2500\u2500 charts\n    \u251c\u2500\u2500 Chart.yaml\n    \u251c\u2500\u2500 templates\n    \u2502   \u251c\u2500\u2500 deployment.yaml\n    \u2502   \u251c\u2500\u2500 _helpers.tpl\n    \u2502   \u251c\u2500\u2500 hpa.yaml\n    \u2502   \u251c\u2500\u2500 ingress.yaml\n    \u2502   \u251c\u2500\u2500 NOTES.txt\n    \u2502   \u251c\u2500\u2500 serviceaccount.yaml\n    \u2502   \u251c\u2500\u2500 service.yaml\n    \u2502   \u2514\u2500\u2500 tests\n    \u2502       \u2514\u2500\u2500 test-connection.yaml\n    \u2514\u2500\u2500 values.yaml\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},".\n\u2514\u2500\u2500 my-app\n    \u251c\u2500\u2500 charts\n    \u251c\u2500\u2500 Chart.yaml\n    \u2514\u2500\u2500 templates\n")))}h.isMDXComponent=!0},7307:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/values-1b26f4797fb95db9ae95b2b557489b0e.png"}}]);